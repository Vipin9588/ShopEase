<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Product Details - ShopEase</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 font-sans">
  <div class="max-w-4xl mx-auto py-10 px-4">
    <a href="index.html" class="text-indigo-600 hover:underline">&larr; Back to Shop</a>

    <div id="content" class="mt-6 bg-white rounded-lg shadow p-6">
      <!-- <div id="loading" class="flex items-center justify-center py-20">
        <svg class="w-12 h-12 animate-spin text-indigo-600" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle></svg>
      </div> -->
      <!-- product content will be injected here -->
    </div>
  </div>


  </a>
<script>
  const API_BASE = 'https://dummyjson.com';
  const params = new URLSearchParams(window.location.search);
  const id = params.get('id');
  const query = new URLSearchParams({id}).toString();  
  const content = document.getElementById('content');

  if (!id) {
    content.innerHTML = `<div class="text-center text-red-500 py-10">No product specified. <a href="index.html" class="text-indigo-600 underline">Back to shop</a></div>`;
  } else {
    fetchProduct(id);
  }

  async function fetchProduct(id) {
    try {
      const res = await fetch(`${API_BASE}/products/${encodeURIComponent(id)}`);
      if (!res.ok) throw new Error('Product fetch failed');
      const p = await res.json();
      renderProduct(p);
    } catch (e) {
      console.error(e);
      content.innerHTML = `<div class="text-center text-red-500 py-10">Failed to load product. <a href="index.html" class="text-indigo-600 underline">Back to shop</a></div>`;
    }
  }

  function renderProduct(p) {
    // images: p.images (array). thumbnail is p.thumbnail
    const imagesHtml = (p.images && p.images.length)
      ? p.images.slice(0,4).map(src => `<img src="${src}" class="w-24 h-24 object-cover rounded-md mr-2">`).join('')
      : `<img src="${p.thumbnail}" class="w-48 h-48 object-cover rounded-md">`;

    content.innerHTML = `
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="md:col-span-1">
          <div class="rounded-lg overflow-hidden mb-4">
            <img src="${p.thumbnail}" alt="${escapeHtml(p.title)}" class="w-full h-64 object-cover">
          </div>
          <div class="flex">${imagesHtml}</div>
        </div>

        <div class="md:col-span-2">
          <h1 class="text-2xl font-bold mb-2">${escapeHtml(p.title)}</h1>
          <div class="flex items-center mb-4">
            <div class="text-yellow-400 mr-3">
              ${renderStars(Math.round(p.rating))}
            </div>
            <div class="text-gray-600"> ${p.rating} â€¢ ${p.stock} in stock</div>
          </div>

          <div class="mb-4">
            <div class="text-gray-500 line-through">$${(p.price + 20).toFixed(2)}</div>
            <div class="text-3xl font-bold text-indigo-600">$${p.price.toFixed(2)}</div>
            ${p.discountPercentage ? `<div class="text-sm text-red-600 mt-1">${p.discountPercentage}% off</div>` : ''}
          </div>

          <p class="text-gray-700 mb-6">${escapeHtml(p.description)}</p>

          <div class="flex gap-3">
            <button id="addToCartBtn" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700">
              <i class="fas fa-shopping-cart mr-2"></i> Add to Cart
            </button>
              <a href="Buy.html?${query}" class="bg-yellow-500 text-black px-6 py-3 rounded-lg hover:brightness-95" >
                  Buy Now
                </a>
          </div>
        </div>
      </div>
    `;


    // attach simple add-to-cart (localStorage)
    document.getElementById('addToCartBtn').addEventListener('click', () => {
      const cart = JSON.parse(localStorage.getItem('shop_cart') || '[]');
      const found = cart.find(x => x.id === p.id);
      if (found) { found.qty += 1; } else { cart.push({ id: p.id, title: p.title, price: p.price, thumbnail: p.thumbnail, qty: 1,discription:p.description }); }
      localStorage.setItem('shop_cart', JSON.stringify(cart));
      alert('Added to cart');
    });

  }

  /* helpers */
  function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
  }
  function renderStars(n){
      let out = '';
      for(let i=0;i<5;i++){
          out += i < n ? '<i class="fas fa-star"></i>' : '<i class="far fa-star"></i>';
      }
      return out;
  }


  

</script>
</body>
</html>
